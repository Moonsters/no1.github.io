if (!window.NIFTY) {
    window.NIFTY = {};
}
if (!window.NIFTY.cocolog) {
    window.NIFTY.cocolog = {};
}

NIFTY.cocolog.cna = function () {
    function cna_generateID () {
        var a = new Date();
        var c = a.getTime(),
            b = Math.floor(Math.random()*55536) + 10000;
        var e = "0000000000000" + c.toString();
        var t = e.substring(e.length - 13, e.length) + b.toString();
    
        return t;
    }

    function cna_checkID (id) {
        if (id.length != 18) {
            return "";
        }

        var e = id.substring(0,1),
            f = id.substring(0,8),
            h = id.substring(13,18);
        var o = parseInt(f),
            b = parseInt(h);

        if ( e != "1" || o < 13410684 || b < 10000 || b > 65535) {
            return "";
        }

        return id;
    }

    function cna_getCookie () {
        var n = "cna_vid=";
        var c = document.cookie + ";";
        var p = c.indexOf(n) + n.length;

        return p < n.length ? "" : unescape(c.substring(p, c.indexOf(";" , p)));
    }

    function cna_getDomain () {
        var subdomains = new Array(".cocolog-nifty.com",".air-nifty.com",".way-nifty.com",".tea-nifty.com",".txt-nifty.com",".moe-nifty.com",".cocolog-wbs.com",".cocolog-tnc.com",".cocolog-tcom.com",".cocolog-shizuoka.com",".cocolog-pikara.com",".cocolog-izu.com",".cocolog-enshu.com",".cocolog-suruga.com");
        var domain = '';
        var document = window.document || new Object();
        for (var i = 0; i < subdomains.length; i++) {
            if (document.domain.indexOf(subdomains[i]) != -1) {
                domain = subdomains[i];
                break;
            }
        }

        return domain;
    }

    function cna_setCookie (v,e) {
        var domain = cna_getDomain();
        var now = new Date();
        document.cookie = "cna_vid=" + escape(v) + "; path=/;domain=" + domain + (e?"; expires=" + (new Date(now.getTime() + e)).toGMTString() : "");
    }

    var vid = cna_getCookie();
    if ("" === cna_checkID(vid)) {
        cna_setCookie(cna_generateID(), 63072000000);
    }
}

window.onpageshow = function (e) { 
    if (e.persisted) {
        NIFTY.cocolog.cna();
    }
};

(function(){
    NIFTY.cocolog.cna();
})();

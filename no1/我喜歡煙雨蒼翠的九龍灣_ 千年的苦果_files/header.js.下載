if (!window.NIFTY) {
    window.NIFTY = {};
}
if (!window.NIFTY.cocolog) {
    window.NIFTY.cocolog = {};
}
NIFTY.cocolog.waitRenderingAd = function(counter, id, func) {
    if (document.getElementById(id)) {
        func();
    } else if (counter > 50) {
        return true;
    } else {
        (function(counter, func) {
            setTimeout(function(){NIFTY.cocolog.waitRenderingAd(counter, id, func)}, 300);
        })(counter + 1, func);
    }
};

NIFTY.cocolog.renderNavigation = function() {
    var spacer = document.createElement('div');
    spacer.className = 'navi-spacer';
    spacer.id = 'navi-spacer';
    spacer.innerHTML = '&nbsp;';
    document.body.insertBefore(spacer, document.body.firstChild);

    var navi = document.createElement('div');
    navi.id = 'gNaviCocolog';
    navi.innerHTML = '<div class="logo"><a href="https://www.nifty.com/"><img width="64" border="0" height="21" class="nifLogo" alt="アット・ニフティ" src="https://www.cocolog-nifty.com/common_header/images/gnavi_logo_nifty.gif"></a><a href="https://www.cocolog-nifty.com/"><img width="88" border="0" height="21" alt="ココログ" src="https://www.cocolog-nifty.com/common_header/images/gnavi_logo_cocolog.gif"></a></div><p>&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.cocolog-nifty.com/login/">ブログを書く</a>&nbsp;|&nbsp;<a href="https://cocolog.kaiketsu.nifty.com/">サポート</a>&nbsp;<p class="gnavi-info"><a href="https://www.cocolog-nifty.com/most_read/">ココログ人気記事ランキング </a></p><form action="https://search.nifty.com/cgi-bin/search.cgi" method="get" name="form1" id="form1"><input type="text" class="textbox1" name="text">&nbsp;<input type="hidden" value="45" name="select"><input type="hidden" value="" name="ss"><input type="submit" value="検索" name="submitBtn" id="gNaviSubmit"></form>';
    document.body.insertBefore(navi, document.body.firstChild);

    // adjust stylesheet because navigation bar and ads break original design
    NIFTY.cocolog.adjustStyle();
};

NIFTY.cocolog.adjustStyle = function(){
    function isSetBackgroundImage(){
        var isMSIE = /*@cc_on!@*/false;

        if (isMSIE){
            return document.body.currentStyle.backgroundImage != 'none';
        } else {
            return document.defaultView.getComputedStyle(document.body, null).backgroundImage != 'none';
        }
    }
    function getBackgroundPosition(){
        var isMSIE = /*@cc_on!@*/false;

        if (isMSIE){
            return document.body.currentStyle.backgroundPositionX + ' ' + document.body.currentStyle.backgroundPositionY;
        } else {
            return document.defaultView.getComputedStyle(document.body, null).backgroundPosition;
        }
    }
    function appendStyle(rule){
        var styleElement = document.createElement('style');
        styleElement.type = "text/css";
        ruleNode = document.createTextNode(rule)

        if (styleElement.styleSheet){
            styleElement.styleSheet.cssText = ruleNode.nodeValue;
        } else {
            styleElement.appendChild(ruleNode);
        }
        document.getElementsByTagName('head')[0].appendChild(styleElement);
    }

    if (isSetBackgroundImage()){
        var currentBackgroundPosition = getBackgroundPosition();
        var pos = currentBackgroundPosition.split(" ");
        if (document.getElementById('container')){
            appendStyle('body{ background-position: ' + pos[0] + ' ' + document.getElementById('container').offsetTop + 'px;}');
        }
    }
    if (document.getElementById('gNaviCocolog')){
        height = document.getElementById('gNaviCocolog').offsetHeight + 10;
        appendStyle('.SmartphoneBtn{ padding-top: ' + height + 'px !important; }');
    }
};

// show after all ads
NIFTY.cocolog.waitRenderingAd(0, 'cocolog-fpa-header', NIFTY.cocolog.renderNavigation);

// setting ad
if (!window.NIFTY) { window.NIFTY = {}; }
if (!window.NIFTY.cocolog) { window.NIFTY.cocolog = {}; }
if (!window.NIFTY.cocolog.ad) { window.NIFTY.cocolog.ad = {}; }
window.NIFTY.cocolog.ad.googleflag = false;

// callback jsonp
window.NIFTY.cocolog.ad.json_callback = function(responseText) {
    var resultWhiteList = NIFTY.cocolog.ad.checkIncludingWhiteList(responseText);
    var resultBlackList = NIFTY.cocolog.ad.checkIncludingBlackList(responseText);
    if (resultWhiteList && !resultBlackList) {
        window.NIFTY.cocolog.ad.googleflag = true;
    }
}

// check whitelist
window.NIFTY.cocolog.ad.checkIncludingWhiteList = function(responseText) {
    if (!responseText || !responseText.whitelist) {
        return false;
    }
    var length = responseText.whitelist.length;
    for (var index = 0; index < length; index++) {
        var url = responseText.whitelist[index];
        if (url === '') {
            return false;
        }
        if (window.NIFTY.cocolog.ad.orgUrl.indexOf(url) !== -1) {
            return true;
        }
    }
    return false;
}

// check blacklist
window.NIFTY.cocolog.ad.checkIncludingBlackList = function(responseText) {
    if (!responseText || !responseText.blacklist) {
        return false;
    }
    var length = responseText.blacklist.length;
    for (var index = 0; index < length; index++) {
        var url = responseText.blacklist[index];
        if (url === window.NIFTY.cocolog.ad.orgUrl) {
            return true;
        }
    }
    return false;
}

// get JSONP data
window.NIFTY.cocolog.ad.getListData = function(originalUrl) {
    var linkElement = document.createElement('a');
    linkElement.href = originalUrl;
    // call .ad-blackwhitelist.js and exec NIFTY.cocolog.ad.json_callback
    var listUrl = linkElement.protocol + "//" + linkElement.host + "/.ad-blackwhitelist.js";
    document.write('<scr' + 'ipt type="text/javascript" src="' + listUrl + '"></scr' + 'ipt>');
}

// get ad file
var ajaxObject = new Ajax(window.location,
    {
        method: 'get',
        async: false,
        onSuccess: function(responseText) {
            var result = responseText.split("\n");
            var length = result.length;
            for (var index = 0; index < length; index++) {
                if (result[index].indexOf("_uah['url']") !== -1) {
                    var line = result[index].trim();
                    window.NIFTY.cocolog.ad.orgUrl = line.replace(/^_uah\['url'\]\s*=\s*'\s*/, "").replace(/\s*';$/, "");
                    NIFTY.cocolog.ad.getListData(NIFTY.cocolog.ad.orgUrl);
                    return;
                }
            }
        },
        exception: function(xhr) {
            window.NIFTY.cocolog.ad.googleflag = false;
        }
    });
ajaxObject.request();

